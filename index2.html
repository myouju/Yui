<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>&#9825;小倉唯楽曲一覧&#9825;</title>
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
    }
    .pink-cell {
        background-color: pink;
    }
    .radio-label {
        display: inline-flex;
        align-items: center;
        font-size: 1.2rem; /* ラベルのフォントサイズ */
        margin-right: 10px;
    }
    .radio-label input[type="radio"] {
        transform: scale(1.5); /* ラジオボタンのサイズを拡大 */
        margin-right: 5px;    /* ラジオボタンとラベルの間隔を調整 */
    }
</style>
</head>
<body>
    <h2>&#9825;小倉唯楽曲一覧&#9825; 
        <a href="tour.html">ツアーセットリスト比較ページ</a> 
        <a href="my.html">未回収楽曲チェックツール</a> 
        <a href="event.html">イベント検索ページ（ベータ版）</a>
    </h2> 

    <div>
        <label><input type="radio" name="artist" value="小倉唯" checked> 小倉唯</label>
        <label><input type="radio" name="artist" value="石原夏織"> 石原夏織</label>
        <label><input type="radio" name="artist" value="ゆいかおり"> ゆいかおり</label>
    </div>

    <table>
        <thead>
            <tr>
                <th>楽曲名(クリックすると歌詞が開きます)</th>
                <th>コール表</th>
                <th>MV(抜け有)</th>
                <th>ライブ映像(抜け有)</th>
                <th>披露回数</th>
                <th>最終披露日</th>
                <th>作詞</th>
                <th>作曲</th>
                <th>編曲</th>
                <th>長さ</th>
                <th>収録CD</th>
                <th>リリース日</th>
            </tr>
        </thead>
        <tbody id="songTable"></tbody>
    </table>

<script>
    function formatDateToJapanese(date) {
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString();
        const day = date.getDate().toString();
        return `${year}年${month}月${day}日`;
    }

function updateSongDetails(songs, CDs, setlists) {
    const songTable = document.getElementById('songTable');
    songTable.innerHTML = ""; // テーブルをリセット

    songs.forEach(song => {
        // CD情報取得
        const matchingCDs = [].concat(song.CDtitle).flatMap(songCDtitle => {
            return CDs.filter(cd => cd.CDtitle === songCDtitle);
        });

        const oldestDate = matchingCDs.length > 0
            ? matchingCDs.reduce((oldest, current) => {
                const oldestDate = new Date(oldest.date.replace(/年|月/g, '-').replace(/日/g, ''));
                const currentDate = new Date(current.date.replace(/年|月/g, '-').replace(/日/g, ''));
                return oldestDate < currentDate ? oldest : current;
            }).date
            : 'No release date found';

        // セットリストからのパフォーマンスデータ集計
        const performanceData = setlists.reduce((acc, setlist) => {
            const date = new Date(setlist.date.replace(/年|月/g, '-').replace(/日/g, ''));

            // セットリストの全楽曲を統一リストに
            const allSongs = [
                ...(Array.isArray(setlist.setlist) ? setlist.setlist : [setlist.setlist]),
                ...(Array.isArray(setlist.encore) ? setlist.encore : [setlist.encore]),
                ...(Array.isArray(setlist.Wencore) ? setlist.Wencore : [setlist.Wencore]),
            ].flat();

            // メドレーなどを展開し、全タイトルを取得
            const titles = allSongs.flatMap(item => {
                if (typeof item === 'object' && 'medley' in item) {
                    return item.medley;
                }
                return item;
            });

            // 対象楽曲が含まれている場合
            if (titles.includes(song.title)) {
                acc.count += 1;
                if (!acc.latestDate || date > acc.latestDate) {
                    acc.latestDate = date;
                    acc.id = setlist.id;
                }
            }

            return acc;
        }, { count: 0, latestDate: null, id: null });

        // 結果のフォーマット
        const latestPerformanceDate = performanceData.latestDate
            ? formatDateToJapanese(performanceData.latestDate)
            : '未披露';

        // テーブル行を作成
        const row = `
            <tr>
                <td><a href="https://www.uta-net.com/song/${song.utanet}">${song.title}</a></td>
                <td>${song.call ? `<a href="https://yuicom-callbook.hatenablog.com/entry/${song.call}" target="_blank">コール表</a>` : ''}</td>
                <td>${song.MVlink ? `<a href="https://www.youtube.com/watch?v=${song.MVlink}" target="_blank">MV</a>` : ''}</td>
                <td>${song.videolink ? `<a href="https://www.youtube.com/watch?v=${song.videolink}" target="_blank">ライブ映像</a>` : ''}</td>
                <td>${performanceData.count}</td>
                <td>${latestPerformanceDate}</td>
                <td class="${song.lyrics.includes('小倉唯') ? 'pink-cell' : ''}">${song.lyrics}</td>
                <td class="${song.music.includes('小倉唯') ? 'pink-cell' : ''}">${song.music}</td>
                <td>${song.arranger}</td>
                <td>${song.length}</td>
                <td>${song.CDtitle}</td>
                <td>${oldestDate}</td>
            </tr>
        `;
        songTable.innerHTML += row;
    });
}

    Promise.all([
        fetch('song.json').then(response => response.json()),
        fetch('CD.json').then(response => response.json()),
        fetch('setlist.json').then(response => response.json())
    ]).then(([songs, CDs, setlists]) => {
        const artistFilter = document.querySelectorAll('input[name="artist"]');
        
        // アーティスト選択時のフィルタリング
        artistFilter.forEach(radio => {
            radio.addEventListener('change', () => {
                const selectedArtist = document.querySelector('input[name="artist"]:checked').value;
                const filteredSongs = songs.filter(song => song.artist === selectedArtist);
                updateSongDetails(filteredSongs, CDs, setlists);
            });
        });

        // 初期表示
        const selectedArtist = document.querySelector('input[name="artist"]:checked').value;
        const filteredSongs = songs.filter(song => song.artist === selectedArtist);
        updateSongDetails(filteredSongs, CDs, setlists);
    }).catch(error => console.error('Failed to fetch data:', error));
</script>
</body>
</html>
